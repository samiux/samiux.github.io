<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康追踪器 | 断食、饮食与健康指标记录</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4a6fa5;
            --secondary: #6b8cbc;
            --light: #f0f4f8;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --border: #dce1e8;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 0 0 20px 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: white;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-btn.active {
            color: var(--primary);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .records-container {
            margin-top: 20px;
        }
        
        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .search-box {
            position: relative;
            width: 100%;
            max-width: 300px;
        }
        
        .search-box input {
            padding-left: 40px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }
        
        .record-item {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            border-left: 4px solid var(--primary);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .record-date {
            font-weight: 600;
            color: var(--dark);
        }
        
        .record-type {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .record-content {
            margin-bottom: 10px;
        }
        
        .record-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--dark);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .action-btn:hover {
            opacity: 1;
        }
        
        .gki-indicator {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .gki-deep {
            background: #27ae60;
            color: white;
        }
        
        .gki-moderate {
            background: #f1c40f;
            color: var(--dark);
        }
        
        .gki-light {
            background: #f39c12;
            color: white;
        }
        
        .gki-low {
            background: #e67e22;
            color: white;
        }
        
        .gki-none {
            background: #e74c3c;
            color: white;
        }
        
        .data-management {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .json-viewer {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow: auto;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
        }
        
        .btn-group .btn {
            flex: 1;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                margin: 0 auto;
            }
            
            .form-row {
                display: flex;
                gap: 15px;
            }
            
            .form-row .form-group {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-heartbeat"></i> 健康追踪器</h1>
            <p>记录饮食、运动与健康指标，优化您的断食与健康生活方式</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="diet"><i class="fas fa-utensils"></i> 饮食记录</button>
            <button class="tab-btn" data-tab="exercise"><i class="fas fa-running"></i> 运动记录</button>
            <button class="tab-btn" data-tab="health"><i class="fas fa-vial"></i> 健康指标</button>
            <button class="tab-btn" data-tab="data"><i class="fas fa-database"></i> 数据管理</button>
        </div>
        
        <!-- 饮食记录标签页 -->
        <div class="tab-content active" id="diet-tab">
            <h2><i class="fas fa-utensils"></i> 记录您的餐食</h2>
            <form id="diet-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="diet-date">日期时间</label>
                        <input type="datetime-local" id="diet-date" required>
                    </div>
                    <div class="form-group">
                        <label for="meal-type">餐食类型</label>
                        <select id="meal-type" required>
                            <option value="">选择餐食类型</option>
                            <option value="breakfast">早餐</option>
                            <option value="lunch">午餐</option>
                            <option value="dinner">晚餐</option>
                            <option value="snack">点心</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="meal-content">餐食内容</label>
                    <textarea id="meal-content" rows="3" placeholder="例如：煎鸡蛋2个、牛油果1个、菠菜沙拉..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="diet-notes">备注</label>
                    <textarea id="diet-notes" rows="2" placeholder="例如：进食后感觉精力充沛..."></textarea>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-plus"></i> 添加饮食记录</button>
            </form>
            
            <div class="records-container">
                <div class="records-header">
                    <h3><i class="fas fa-history"></i> 最近的饮食记录</h3>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="diet-search" placeholder="搜索饮食记录...">
                    </div>
                </div>
                <div id="diet-records"></div>
            </div>
        </div>
        
        <!-- 运动记录标签页 -->
        <div class="tab-content" id="exercise-tab">
            <h2><i class="fas fa-running"></i> 记录您的运动</h2>
            <form id="exercise-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="exercise-date">日期时间</label>
                        <input type="datetime-local" id="exercise-date" required>
                    </div>
                    <div class="form-group">
                        <label for="exercise-type">运动类型</label>
                        <select id="exercise-type" required>
                            <option value="">选择运动类型</option>
                            <option value="walking">散步</option>
                            <option value="running">跑步</option>
                            <option value="cycling">骑行</option>
                            <option value="swimming">游泳</option>
                            <option value="yoga">瑜伽</option>
                            <option value="weight">力量训练</option>
                            <option value="hiit">高强度间歇训练</option>
                            <option value="others">其他</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="exercise-duration">时长 (分钟)</label>
                        <input type="number" id="exercise-duration" min="1" max="300" required>
                    </div>
                    <div class="form-group">
                        <label for="exercise-intensity">强度</label>
                        <select id="exercise-intensity" required>
                            <option value="low">低强度</option>
                            <option value="moderate" selected>中等强度</option>
                            <option value="high">高强度</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="exercise-notes">备注</label>
                    <textarea id="exercise-notes" rows="2" placeholder="例如：完成5公里跑步，感觉良好..."></textarea>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-plus"></i> 添加运动记录</button>
            </form>
            
            <div class="records-container">
                <div class="records-header">
                    <h3><i class="fas fa-history"></i> 最近的运动记录</h3>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="exercise-search" placeholder="搜索运动记录...">
                    </div>
                </div>
                <div id="exercise-records"></div>
            </div>
        </div>
        
        <!-- 健康指标标签页 -->
        <div class="tab-content" id="health-tab">
            <h2><i class="fas fa-vial"></i> 记录健康指标</h2>
            <form id="health-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="health-date">日期时间</label>
                        <input type="datetime-local" id="health-date" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="glucose">血糖 (mmol/L)</label>
                        <input type="number" id="glucose" step="0.1" min="1" max="20" placeholder="例如：5.4" required>
                    </div>
                    <div class="form-group">
                        <label for="ketone">血酮 (mmol/L)</label>
                        <input type="number" id="ketone" step="0.1" min="0.1" max="8" placeholder="例如：1.8" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="health-notes">备注</label>
                    <textarea id="health-notes" rows="2" placeholder="例如：测量前断食16小时..."></textarea>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-plus"></i> 添加健康指标</button>
            </form>
            
            <div class="form-group" id="gki-result" style="display: none; margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 10px;">
                <h3><i class="fas fa-calculator"></i> GKI计算结果</h3>
                <p>血糖酮指数 (GKI): <span id="gki-value"></span> - <span id="gki-status" class="gki-indicator"></span></p>
                <p id="gki-explanation"></p>
            </div>
            
            <div class="records-container">
                <div class="records-header">
                    <h3><i class="fas fa-history"></i> 最近的健康指标</h3>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="health-search" placeholder="搜索健康指标...">
                    </div>
                </div>
                <div id="health-records"></div>
            </div>
        </div>
        
        <!-- 数据管理标签页 -->
        <div class="tab-content" id="data-tab">
            <h2><i class="fas fa-database"></i> 数据管理</h2>
            
            <div class="data-management">
                <div class="form-group">
                    <label>导出数据 (JSON格式)</label>
                    <button id="export-btn" class="btn btn-success"><i class="fas fa-download"></i> 导出所有数据</button>
                </div>
                
                <div class="form-group">
                    <label>导入数据 (JSON格式)</label>
                    <input type="file" id="import-file" accept=".json" style="margin-bottom: 10px;">
                    <button id="import-btn" class="btn btn-warning"><i class="fas fa-upload"></i> 导入数据</button>
                </div>
                
                <div class="form-group">
                    <label>清除所有数据</label>
                    <button id="clear-btn" class="btn btn-danger"><i class="fas fa-trash"></i> 清除所有记录</button>
                </div>
                
                <div class="form-group">
                    <label>当前数据预览</label>
                    <div class="json-viewer" id="data-preview">没有数据</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>健康追踪器 v1.0 | 基于最新断食科学研究 | 所有数据存储在您的浏览器中</p>
    </div>

    <script>
        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            // 设置当前日期时间为默认值
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            
            // 设置所有日期时间输入框的默认值
            document.querySelectorAll('input[type="datetime-local"]').forEach(input => {
                input.value = localDateTime;
            });
            
            // 加载数据
            loadData();
            
            // 标签页切换
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // 移除所有活动标签
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // 激活当前标签
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // 表单提交事件
            document.getElementById('diet-form').addEventListener('submit', addDietRecord);
            document.getElementById('exercise-form').addEventListener('submit', addExerciseRecord);
            document.getElementById('health-form').addEventListener('submit', addHealthRecord);
            
            // 数据管理事件
            document.getElementById('export-btn').addEventListener('click', exportData);
            document.getElementById('import-btn').addEventListener('click', importData);
            document.getElementById('clear-btn').addEventListener('click', clearData);
            
            // 搜索功能
            document.getElementById('diet-search').addEventListener('input', filterDietRecords);
            document.getElementById('exercise-search').addEventListener('input', filterExerciseRecords);
            document.getElementById('health-search').addEventListener('input', filterHealthRecords);
        });
        
        // 数据结构
        let healthData = {
            diet: [],
            exercise: [],
            health: []
        };
        
        // 加载数据
        function loadData() {
            const savedData = localStorage.getItem('healthTrackerData');
            if (savedData) {
                healthData = JSON.parse(savedData);
            }
            renderAllRecords();
            updateDataPreview();
        }
        
        // 保存数据
        function saveData() {
            localStorage.setItem('healthTrackerData', JSON.stringify(healthData));
            renderAllRecords();
            updateDataPreview();
        }
        
        // 添加饮食记录
        function addDietRecord(e) {
            e.preventDefault();
            
            const record = {
                id: Date.now(),
                date: document.getElementById('diet-date').value,
                type: document.getElementById('meal-type').value,
                content: document.getElementById('meal-content').value,
                notes: document.getElementById('diet-notes').value,
                category: 'diet'
            };
            
            healthData.diet.unshift(record);
            saveData();
            
            // 重置表单
            document.getElementById('diet-form').reset();
            document.getElementById('diet-date').value = new Date(new Date().getTime() - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            
            // 显示成功消息
            showToast('饮食记录已添加！');
        }
        
        // 添加运动记录
        function addExerciseRecord(e) {
            e.preventDefault();
            
            const record = {
                id: Date.now(),
                date: document.getElementById('exercise-date').value,
                type: document.getElementById('exercise-type').value,
                duration: document.getElementById('exercise-duration').value,
                intensity: document.getElementById('exercise-intensity').value,
                notes: document.getElementById('exercise-notes').value,
                category: 'exercise'
            };
            
            healthData.exercise.unshift(record);
            saveData();
            
            // 重置表单
            document.getElementById('exercise-form').reset();
            document.getElementById('exercise-date').value = new Date(new Date().getTime() - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            
            // 显示成功消息
            showToast('运动记录已添加！');
        }
        
        // 添加健康指标
        function addHealthRecord(e) {
            e.preventDefault();
            
            const glucose = parseFloat(document.getElementById('glucose').value);
            const ketone = parseFloat(document.getElementById('ketone').value);
            const gki = calculateGKI(glucose, ketone);
            const gkiStatus = getGKIStatus(gki);
            
            const record = {
                id: Date.now(),
                date: document.getElementById('health-date').value,
                glucose: glucose,
                ketone: ketone,
                gki: gki,
                status: gkiStatus,
                notes: document.getElementById('health-notes').value,
                category: 'health'
            };
            
            healthData.health.unshift(record);
            saveData();
            
            // 显示GKI计算结果
            document.getElementById('gki-result').style.display = 'block';
            document.getElementById('gki-value').textContent = gki.toFixed(1);
            document.getElementById('gki-status').textContent = gkiStatus.text;
            document.getElementById('gki-status').className = `gki-indicator ${gkiStatus.class}`;
            document.getElementById('gki-explanation').textContent = gkiStatus.explanation;
            
            // 重置表单
            document.getElementById('health-form').reset();
            document.getElementById('health-date').value = new Date(new Date().getTime() - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            
            // 显示成功消息
            showToast('健康指标已添加！');
        }
        
        // 计算GKI
        function calculateGKI(glucose, ketone) {
            return glucose / ketone;
        }
        
        // 获取GKI状态
        function getGKIStatus(gki) {
            if (gki < 1) {
                return {
                    class: 'gki-deep',
                    text: '深度酮症',
                    explanation: '最佳代谢状态，通常出现在长期生酮饮食或治疗性生酮中'
                };
            } else if (gki >= 1 && gki < 3) {
                return {
                    class: 'gki-moderate',
                    text: '中等酮症',
                    explanation: '理想的营养性酮症状态，脂肪燃烧效率高'
                };
            } else if (gki >= 3 && gki < 6) {
                return {
                    class: 'gki-light',
                    text: '轻度酮症',
                    explanation: '初期酮症状态，可能处于代谢灵活性过渡期'
                };
            } else if (gki >= 6 && gki < 9) {
                return {
                    class: 'gki-low',
                    text: '低度酮症',
                    explanation: '轻微酮症，可能受到碳水摄入或压力的影响'
                };
            } else {
                return {
                    class: 'gki-none',
                    text: '无酮症',
                    explanation: '未处于酮症状态，主要依赖葡萄糖供能'
                };
            }
        }
        
        // 渲染所有记录
        function renderAllRecords() {
            renderDietRecords();
            renderExerciseRecords();
            renderHealthRecords();
        }
        
        // 渲染饮食记录
        function renderDietRecords(records = healthData.diet) {
            const container = document.getElementById('diet-records');
            if (!records.length) {
                container.innerHTML = '<div class="record-item"><p>暂无饮食记录</p></div>';
                return;
            }
            
            container.innerHTML = '';
            records.forEach(record => {
                const mealTypes = {
                    breakfast: '早餐',
                    lunch: '午餐',
                    dinner: '晚餐',
                    snack: '点心'
                };
                
                const date = new Date(record.date);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                
                const recordEl = document.createElement('div');
                recordEl.className = 'record-item';
                recordEl.innerHTML = `
                    <div class="record-header">
                        <div class="record-date">${formattedDate}</div>
                        <div class="record-type">${mealTypes[record.type] || record.type}</div>
                    </div>
                    <div class="record-content">
                        <p><strong>内容:</strong> ${record.content}</p>
                        ${record.notes ? `<p><strong>备注:</strong> ${record.notes}</p>` : ''}
                    </div>
                    <div class="record-actions">
                        <button class="action-btn delete-btn" data-id="${record.id}" data-category="diet"><i class="fas fa-trash"></i> 删除</button>
                    </div>
                `;
                
                container.appendChild(recordEl);
            });
            
            // 添加删除事件
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const category = this.getAttribute('data-category');
                    deleteRecord(id, category);
                });
            });
        }
        
        // 渲染运动记录
        function renderExerciseRecords(records = healthData.exercise) {
            const container = document.getElementById('exercise-records');
            if (!records.length) {
                container.innerHTML = '<div class="record-item"><p>暂无运动记录</p></div>';
                return;
            }
            
            container.innerHTML = '';
            records.forEach(record => {
                const exerciseTypes = {
                    walking: '散步',
                    running: '跑步',
                    cycling: '骑行',
                    swimming: '游泳',
                    yoga: '瑜伽',
                    weight: '力量训练',
                    hiit: '高强度间歇训练'
                };
                
                const intensityMap = {
                    low: '低强度',
                    moderate: '中等强度',
                    high: '高强度'
                };
                
                const date = new Date(record.date);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                
                const recordEl = document.createElement('div');
                recordEl.className = 'record-item';
                recordEl.innerHTML = `
                    <div class="record-header">
                        <div class="record-date">${formattedDate}</div>
                        <div class="record-type">${exerciseTypes[record.type] || record.type}</div>
                    </div>
                    <div class="record-content">
                        <p><strong>时长:</strong> ${record.duration} 分钟</p>
                        <p><strong>强度:</strong> ${intensityMap[record.intensity] || record.intensity}</p>
                        ${record.notes ? `<p><strong>备注:</strong> ${record.notes}</p>` : ''}
                    </div>
                    <div class="record-actions">
                        <button class="action-btn delete-btn" data-id="${record.id}" data-category="exercise"><i class="fas fa-trash"></i> 删除</button>
                    </div>
                `;
                
                container.appendChild(recordEl);
            });
            
            // 添加删除事件
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const category = this.getAttribute('data-category');
                    deleteRecord(id, category);
                });
            });
        }
        
        // 渲染健康记录
        function renderHealthRecords(records = healthData.health) {
            const container = document.getElementById('health-records');
            if (!records.length) {
                container.innerHTML = '<div class="record-item"><p>暂无健康指标记录</p></div>';
                return;
            }
            
            container.innerHTML = '';
            records.forEach(record => {
                const date = new Date(record.date);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                const gkiStatus = getGKIStatus(record.gki);
                
                const recordEl = document.createElement('div');
                recordEl.className = 'record-item';
                recordEl.innerHTML = `
                    <div class="record-header">
                        <div class="record-date">${formattedDate}</div>
                        <div class="record-type">健康指标</div>
                    </div>
                    <div class="record-content">
                        <p><strong>血糖:</strong> ${record.glucose} mmol/L</p>
                        <p><strong>血酮:</strong> ${record.ketone} mmol/L</p>
                        <p><strong>GKI:</strong> ${record.gki.toFixed(1)} - <span class="gki-indicator ${gkiStatus.class}">${gkiStatus.text}</span></p>
                        ${record.notes ? `<p><strong>备注:</strong> ${record.notes}</p>` : ''}
                    </div>
                    <div class="record-actions">
                        <button class="action-btn delete-btn" data-id="${record.id}" data-category="health"><i class="fas fa-trash"></i> 删除</button>
                    </div>
                `;
                
                container.appendChild(recordEl);
            });
            
            // 添加删除事件
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const category = this.getAttribute('data-category');
                    deleteRecord(id, category);
                });
            });
        }
        
        // 删除记录
        function deleteRecord(id, category) {
            if (confirm('确定要删除此记录吗？')) {
                healthData[category] = healthData[category].filter(record => record.id !== id);
                saveData();
                showToast('记录已删除');
            }
        }
        
        // 导出数据
        function exportData() {
            const dataStr = JSON.stringify(healthData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `health-tracker-data-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('数据已导出');
        }
        
        // 导入数据
        function importData() {
            const fileInput = document.getElementById('import-file');
            if (!fileInput.files.length) {
                alert('请选择要导入的JSON文件');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // 验证数据结构
                    if (importedData.diet && importedData.exercise && importedData.health) {
                        if (confirm('导入数据将覆盖当前所有记录。确定要导入吗？')) {
                            healthData = importedData;
                            saveData();
                            showToast('数据导入成功');
                        }
                    } else {
                        alert('导入的文件格式不正确');
                    }
                } catch (error) {
                    alert('解析JSON文件时出错: ' + error.message);
                }
            };
            
            reader.readAsText(file);
        }
        
        // 清除数据
        function clearData() {
            if (confirm('确定要清除所有记录吗？此操作不可撤销！')) {
                healthData = {
                    diet: [],
                    exercise: [],
                    health: []
                };
                saveData();
                showToast('所有记录已清除');
            }
        }
        
        // 更新数据预览
        function updateDataPreview() {
            const preview = document.getElementById('data-preview');
            if (healthData.diet.length || healthData.exercise.length || healthData.health.length) {
                preview.textContent = JSON.stringify(healthData, null, 2);
            } else {
                preview.textContent = '没有数据';
            }
        }
        
        // 筛选饮食记录
        function filterDietRecords() {
            const searchTerm = document.getElementById('diet-search').value.toLowerCase();
            const filtered = healthData.diet.filter(record => {
                const mealTypes = {
                    breakfast: '早餐',
                    lunch: '午餐',
                    dinner: '晚餐',
                    snack: '点心'
                };
                
                const type = mealTypes[record.type] || record.type;
                return (
                    type.toLowerCase().includes(searchTerm) ||
                    record.content.toLowerCase().includes(searchTerm) ||
                    (record.notes && record.notes.toLowerCase().includes(searchTerm))
                );
            });
            renderDietRecords(filtered);
        }
        
        // 筛选运动记录
        function filterExerciseRecords() {
            const searchTerm = document.getElementById('exercise-search').value.toLowerCase();
            const filtered = healthData.exercise.filter(record => {
                const exerciseTypes = {
                    walking: '散步',
                    running: '跑步',
                    cycling: '骑行',
                    swimming: '游泳',
                    yoga: '瑜伽',
                    weight: '力量训练',
                    hiit: '高强度间歇训练'
                };
                
                const type = exerciseTypes[record.type] || record.type;
                return (
                    type.toLowerCase().includes(searchTerm) ||
                    (record.notes && record.notes.toLowerCase().includes(searchTerm))
                );
            });
            renderExerciseRecords(filtered);
        }
        
        // 筛选健康记录
        function filterHealthRecords() {
            const searchTerm = document.getElementById('health-search').value.toLowerCase();
            const filtered = healthData.health.filter(record => {
                return (
                    record.glucose.toString().includes(searchTerm) ||
                    record.ketone.toString().includes(searchTerm) ||
                    record.gki.toFixed(1).includes(searchTerm) ||
                    record.status.toLowerCase().includes(searchTerm) ||
                    (record.notes && record.notes.toLowerCase().includes(searchTerm))
                );
            });
            renderHealthRecords(filtered);
        }
        
        // 显示Toast通知
        function showToast(message) {
            // 移除现有的toast
            const existingToast = document.getElementById('health-toast');
            if (existingToast) existingToast.remove();
            
            const toast = document.createElement('div');
            toast.id = 'health-toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--primary);
                color: white;
                padding: 12px 24px;
                border-radius: 30px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: fadeInOut 3s ease;
            `;
            
            document.body.appendChild(toast);
            
            // 3秒后移除
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.5s ease forwards';
                setTimeout(() => toast.remove(), 500);
            }, 2500);
            
            // 添加CSS动画
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, 20px); }
                    10% { opacity: 1; transform: translate(-50%, 0); }
                    90% { opacity: 1; transform: translate(-50%, 0); }
                    100% { opacity: 0; transform: translate(-50%, 20px); }
                }
                @keyframes fadeOut {
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
